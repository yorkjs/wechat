import*as e from"@yorkjs/url";let t;function n(){return t}function i(e){return t.storage.get(`@@wechat@@_${e}`)}function r(e,n){t.storage.set(`@@wechat@@_${e}`,n)}function a(e,t,n,i,r){let a=`appid=${i}&redirect_uri=${encodeURIComponent(t)}&response_type=code&scope=${n}&state=${e}`;r&&(a+=`&component_appid=${r}`),location.href=`https://open.weixin.qq.com/connect/oauth2/authorize?${a}#wechat_redirect`}const o={};function s(e,t){const i=n();return e>0&&i.getTimestamp()-e<t}const c=function(e){t=e},u=function(e,t,i,o){const s=n().getTimestamp(),c=encodeURIComponent(`${e}@${s}`);r(e,JSON.stringify({state:e,timestamp:s})),a(c,t,"snsapi_userinfo",i,o)},p=function(e,t,i,o){const s=n().getTimestamp(),c=encodeURIComponent(`${e}@${s}`);r(e,JSON.stringify({state:e,timestamp:s})),a(c,t,"snsapi_base",i,o)},m=function(e){var n;n=e,t.storage.remove(`@@wechat@@_${n}`)},l=function(t,n){const r=function(t){const n={},i=e.parseUrl(t);if(!i.search)return n;const r=e.parseQuery(i.search.slice(1));if(r.state&&r.code){const[e,t]=r.state.split("@");n.code=r.code,n.state=e,n.timestamp=+t}return n}(t),{state:a,code:c,timestamp:u}=r;if(a&&c&&u){if(!n)return r;const{once:e}=n;if(!function(e,t){const{expireSeconds:n,once:i}=t,{state:r,timestamp:a}=e;return!(!r||!a||n&&!s(a,1e3*n)||i&&o[r])}(r,n))return{};if(!function(e,t){let n=i(e)||{};if(n&&"string"==typeof n)try{n=JSON.parse(n)}catch(e){n={}}const{expireSeconds:r,once:a}=t,{state:c,timestamp:u}=n;return!(!c||!u||r&&!s(u,1e3*r)||a&&o[c])}(a,n))return{};if(!function(e){const{state:t,timestamp:n}=e;if(t&&n){let e=i(t)||{};if(e&&"string"==typeof e)try{e=JSON.parse(e)}catch(t){e={}}return e.state===t&&e.timestamp===n}return!1}(r))return{};e&&(o[a]=!0)}return r},f=function(e,t,n){return new Promise((function(i,r){n().then((function(n){const r=["onMenuShareAppMessage","onMenuShareTimeline","updateAppMessageShareData","updateTimelineShareData","onMenuShareWeibo","previewImage"];e.config({debug:!1,appId:n.app_id,timestamp:n.timestamp,nonceStr:n.noncestr,signature:n.signature,jsApiList:r}),e.ready((function(){e.checkJsApi({jsApiList:r,success(n){const i=n.checkResult;i.updateAppMessageShareData&&e.updateAppMessageShareData({title:t.title,desc:t.content,link:t.url,imgUrl:t.image}),i.onMenuShareAppMessage&&e.onMenuShareAppMessage({title:t.title,desc:t.content,link:t.url,imgUrl:t.image}),i.updateTimelineShareData&&e.updateTimelineShareData({title:t.title,link:t.url,imgUrl:t.image}),i.onMenuShareTimeline&&e.onMenuShareTimeline({title:t.title,link:t.url,imgUrl:t.image}),i.onMenuShareWeibo&&e.onMenuShareWeibo({title:t.title,desc:t.content,link:t.url,imgUrl:t.image})}})})),i()})).catch((function(e){r(e)}))}))},g=function(e){return new Promise((function(t,n){window.WeixinJSBridge?window.WeixinJSBridge.invoke("getBrandWCPayRequest",e,(function(e){const{err_msg:i}=e;"get_brand_wcpay_request:ok"==i?t(e):"get_brand_wcpay_request:cancel"!==i&&n(i||"支付失败")})):n("缺少微信环境支持")}))},d="1.1.0";export{m as endAuth,l as getAuthQuery,c as init,g as pay,f as share,u as startAuth,p as startSilentAuth,d as version};
//# sourceMappingURL=wechat.esm.min.js.map
