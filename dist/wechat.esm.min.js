import*as e from"@yorkjs/url";let t;function n(){return t}const i=navigator.userAgent,r=/iphone|ipad/i.test(i),a=/android/i.test(i);let o=!1;function s(){var e,i;o&&(e="auth_page_unload_timestamp",i=n().getTimestamp(),t.storage.set(`@@wechat@@_${e}`,i))}function c(e,t,n,i,r){let a=`appid=${i}&redirect_uri=${encodeURIComponent(t)}&response_type=code&scope=${n}&state=${e}`;r&&(a+=`&component_appid=${r}`),o=!0,location.href=`https://open.weixin.qq.com/connect/oauth2/authorize?${a}#wechat_redirect`}function u(t,n){const i=e.parseUrl(t);if(i.search){const t=e.parseQuery(i.search.slice(1));if(t.state&&t.code){delete t.state,delete t.code;const n=e.stringifyQuery(t);i.search=n?`?${n}`:""}}return n&&n(i),e.stringifyUrl(i)}r?window.addEventListener("pagehide",(function(e){s()})):window.addEventListener("unload",(function(e){s()}));const p={};function d(e){const i=n().getTimestamp(),r=(a="auth_page_unload_timestamp",t.storage.get(`@@wechat@@_${a}`));var a;return!!r&&i-r<e}const l=function(e){t=e},m=function(e,t,n,i){c(encodeURIComponent(e),t,"snsapi_userinfo",n,i)},g=function(e,t,n,i){c(encodeURIComponent(e),t,"snsapi_base",n,i)},h=function(e){var n;n="auth_page_unload_timestamp",t.storage.remove(`@@wechat@@_${n}`)},f=function(t,n){const i=function(t){const n={},i=e.parseUrl(t);if(!i.search)return n;const r=e.parseQuery(i.search.slice(1));return r.state&&r.code&&(n.code=r.code,n.state=r.state),n}(t),{state:r,code:a}=i;if(r&&a){if(!n)return i;const{once:e}=n;if(!function(e,t){const{expireSeconds:n,once:i}=t,{state:r}=e;return!(!r||n&&!d(1e3*n)||i&&p[r])}(i,n))return{};e&&(p[r]=!0)}return i},_=function(e,t,n,i,r=!1){return new Promise((function(a,o){e.config({debug:r,appId:t.appId,timestamp:t.timestamp,nonceStr:t.nonceStr,signature:t.signature,jsApiList:n}),e.ready((function(){e.checkJsApi({jsApiList:n,success(t){const n=t.checkResult;n.updateAppMessageShareData&&e.updateAppMessageShareData({title:i.title,desc:i.content,link:i.url,imgUrl:i.image}),n.updateTimelineShareData&&e.updateTimelineShareData({title:i.title,link:i.url,imgUrl:i.image}),n.onMenuShareWeibo&&e.onMenuShareWeibo({title:i.title,desc:i.content,link:i.url,imgUrl:i.image}),n.onMenuShareAppMessage&&e.onMenuShareAppMessage({title:i.title,desc:i.content,link:i.url,imgUrl:i.image}),n.onMenuShareTimeline&&e.onMenuShareTimeline({title:i.title,link:i.url,imgUrl:i.image})}})})),e.error((function(e){o(e)})),a()}))},w=function(e){return new Promise((function(t,n){window.WeixinJSBridge?window.WeixinJSBridge.invoke("getBrandWCPayRequest",e,(function(e){const{err_msg:i}=e;"get_brand_wcpay_request:ok"==i?t(e):"get_brand_wcpay_request:cancel"!==i&&n(i||"支付失败")})):n("缺少微信环境支持")}))},S=u,y=function(e,t){return u(e,(function(e){t&&t(e);const n=e.search&&"?"!==e.search;a&&!n&&e.hash&&(e.hash=`?${e.hash}`)}))},U="1.3.6";export{h as endAuth,f as getAuthQuery,l as init,y as normalizeShareUrl,S as normalizeUrl,w as pay,_ as share,m as startAuth,g as startSilentAuth,U as version};
//# sourceMappingURL=wechat.esm.min.js.map
