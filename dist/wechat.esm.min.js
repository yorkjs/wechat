import*as e from"@yorkjs/url";let t;function n(){return t}function i(e){return t.storage.get(`@@wechat@@_${e}`)}function a(e,n){t.storage.set(`@@wechat@@_${e}`,n)}function s(e,t,n,i,a){let s=`appid=${i}&redirect_uri=${encodeURIComponent(t)}&response_type=code&scope=${n}&state=${e}`;a&&(s+=`&component_appid=${a}`),location.href=`https://open.weixin.qq.com/connect/oauth2/authorize?${s}#wechat_redirect`}const r={};function o(e,t){const i=n();return e>0&&i.getTimestamp()-e<t}const c=require("weixin-js-sdk");const p=function(e){t=e},u=function(e,t,i,r){const o=n().getTimestamp(),c=encodeURIComponent(`${e}@${o}`);a(e,JSON.stringify({state:e,timestamp:o})),s(c,t,"snsapi_userinfo",i,r)},m=function(e,t,i,r){const o=n().getTimestamp(),c=encodeURIComponent(`${e}@${o}`);a(e,JSON.stringify({state:e,timestamp:o})),s(c,t,"snsapi_base",i,r)},l=function(t,n){const a=function(t){const n={},i=e.parseUrl(t);if(!i.search)return n;const a=e.parseQuery(i.search.slice(1));if(a.state&&a.code){const[e,t]=a.state.split("@");n.code=a.code,n.state=e,n.timestamp=+t}return n}(t),{state:s,code:c,timestamp:p}=a;if(s&&c&&p){if(!n)return a;const{once:e}=n;if(!function(e,t){const{expireSeconds:n,once:i}=t,{state:a,timestamp:s}=e;return!(!a||!s||n&&!o(s,1e3*n)||i&&r[a])}(a,n))return{};if(!function(e,t){let n=i(e)||{};n&&"string"==typeof n&&(n=JSON.parse(n));const{expireSeconds:a,once:s}=t,{state:c,timestamp:p}=n;return!(!c||!p||a&&!o(p,1e3*a)||s&&r[c])}(s,n))return{};if(!function(e){const{state:t,timestamp:n}=e;if(t&&n){let e=i(t)||{};return e&&"string"==typeof e&&(e=JSON.parse(e)),e.state===t&&e.timestamp===n}return!1}(a))return{};e&&(r[s]=!0)}return a},d=function(e,t,i,a=!1){if(window.sendMessage&&window.sendMessage({command:"pageInfo",href:e.url,title:e.title,desc:e.content,thumbnail:e.image}),!a)return;const{location:s}=window;let r=s.href;s.hash&&(r=r.replace(s.hash,"")),n().jssdkSignture({appId:t,appType:i,url:r}).then((t=>{if(0===t.code){let n=t.data,i=["onMenuShareAppMessage","onMenuShareTimeline","updateAppMessageShareData","updateTimelineShareData","onMenuShareWeibo","previewImage"];c.config({debug:!1,appId:n.app_id,timestamp:n.timestamp,nonceStr:n.noncestr,signature:n.signature,jsApiList:i}),c.ready((()=>{c.checkJsApi({jsApiList:i,success:t=>{let n=t.checkResult;n.updateAppMessageShareData&&c.updateAppMessageShareData({title:e.title,desc:e.content,link:e.url,imgUrl:e.image}),n.onMenuShareAppMessage&&c.onMenuShareAppMessage({title:e.title,desc:e.content,link:e.url,imgUrl:e.image}),n.updateTimelineShareData&&c.updateTimelineShareData({title:e.title,link:e.url,imgUrl:e.image}),n.onMenuShareTimeline&&c.onMenuShareTimeline({title:e.title,link:e.url,imgUrl:e.image}),n.onMenuShareWeibo&&c.onMenuShareWeibo({title:e.title,desc:e.content,link:e.url,imgUrl:e.image})}})}))}}))},g=function(e){return new Promise((function(t,n){window.WeixinJSBridge?window.WeixinJSBridge.invoke("getBrandWCPayRequest",e,(function(e){const{err_msg:i}=e;"get_brand_wcpay_request:ok"==i?t(e):"get_brand_wcpay_request:cancel"!==i&&n(i||"支付失败")})):n("缺少微信环境支持")}))},f="0.0.1";export{l as getAuthQuery,p as init,g as pay,u as requestAuth,m as requestSilentAuth,d as share,f as version};
//# sourceMappingURL=wechat.esm.min.js.map
