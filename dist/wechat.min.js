!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@yorkjs/url")):"function"==typeof define&&define.amd?define(["exports","@yorkjs/url"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Url={},e.Url)}(this,(function(e,t){"use strict";var n;function i(){return n}function r(e){return n.storage.get("@@wechat@@_"+e)}function a(e,t){n.storage.set("@@wechat@@_"+e,t)}function s(e,t,n,i,r){var a="appid="+i+"&redirect_uri="+encodeURIComponent(t)+"&response_type=code&scope="+n+"&state="+e;r&&(a+="&component_appid="+r),location.href="https://open.weixin.qq.com/connect/oauth2/authorize?"+a+"#wechat_redirect"}var o={};function u(e,t){var n=i();return e>0&&n.getTimestamp()-e<t}var p=require("weixin-js-sdk");var c=function(e){n=e},d=function(e,t,n,r){var o=i().getTimestamp(),u=encodeURIComponent(e+"@"+o);a(e,JSON.stringify({state:e,timestamp:o})),s(u,t,"snsapi_userinfo",n,r)},l=function(e,t,n,r){var o=i().getTimestamp(),u=encodeURIComponent(e+"@"+o);a(e,JSON.stringify({state:e,timestamp:o})),s(u,t,"snsapi_base",n,r)},m=function(e,n){var i=function(e){var n={},i=t.parseUrl(e);if(!i.search)return n;var r=t.parseQuery(i.search.slice(1));if(r.state&&r.code){var a=r.state.split("@"),s=a[0],o=a[1];n.code=r.code,n.state=s,n.timestamp=+o}return n}(e),a=i.state,s=i.code,p=i.timestamp;if(a&&s&&p){if(!n)return i;var c=n.once;if(!function(e,t){var n=t.expireSeconds,i=t.once,r=e.state,a=e.timestamp;return!(!r||!a||n&&!u(a,1e3*n)||i&&o[r])}(i,n))return{};if(!function(e,t){var n=r(e)||{};n&&"string"==typeof n&&(n=JSON.parse(n));var i=t.expireSeconds,a=t.once,s=n.state,p=n.timestamp;return!(!s||!p||i&&!u(p,1e3*i)||a&&o[s])}(a,n))return{};if(!function(e){var t=e.state,n=e.timestamp;if(t&&n){var i=r(t)||{};return i&&"string"==typeof i&&(i=JSON.parse(i)),i.state===t&&i.timestamp===n}return!1}(i))return{};c&&(o[a]=!0)}return i},f=function(e,t,n,r){if(void 0===r&&(r=!1),window.sendMessage&&window.sendMessage({command:"pageInfo",href:e.url,title:e.title,desc:e.content,thumbnail:e.image}),r){var a=window.location,s=a.href;a.hash&&(s=s.replace(a.hash,"")),i().jssdkSignture({appId:t,appType:n,url:s}).then((function(t){if(0===t.code){var n=t.data,i=["onMenuShareAppMessage","onMenuShareTimeline","updateAppMessageShareData","updateTimelineShareData","onMenuShareWeibo","previewImage"];p.config({debug:!1,appId:n.app_id,timestamp:n.timestamp,nonceStr:n.noncestr,signature:n.signature,jsApiList:i}),p.ready((function(){p.checkJsApi({jsApiList:i,success:function(t){var n=t.checkResult;n.updateAppMessageShareData&&p.updateAppMessageShareData({title:e.title,desc:e.content,link:e.url,imgUrl:e.image}),n.onMenuShareAppMessage&&p.onMenuShareAppMessage({title:e.title,desc:e.content,link:e.url,imgUrl:e.image}),n.updateTimelineShareData&&p.updateTimelineShareData({title:e.title,link:e.url,imgUrl:e.image}),n.onMenuShareTimeline&&p.onMenuShareTimeline({title:e.title,link:e.url,imgUrl:e.image}),n.onMenuShareWeibo&&p.onMenuShareWeibo({title:e.title,desc:e.content,link:e.url,imgUrl:e.image})}})}))}}))}},g=function(e){return new Promise((function(t,n){window.WeixinJSBridge?window.WeixinJSBridge.invoke("getBrandWCPayRequest",e,(function(e){var i=e.err_msg;"get_brand_wcpay_request:ok"==i?t(e):"get_brand_wcpay_request:cancel"!==i&&n(i||"支付失败")})):n("缺少微信环境支持")}))};e.getAuthQuery=m,e.init=c,e.pay=g,e.requestAuth=d,e.requestSilentAuth=l,e.share=f,e.version="0.0.1",Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=wechat.min.js.map
