!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@yorkjs/url")):"function"==typeof define&&define.amd?define(["exports","@yorkjs/url"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Url={},e.Url)}(this,(function(e,t){"use strict";var r;function n(){return r}function i(e){return r.storage.get("@@wechat@@_"+e)}function a(e,t){r.storage.set("@@wechat@@_"+e,t)}var s=navigator.userAgent;/iphone|ipad/i.test(s);var o=/android/i.test(s);function u(e,t,r,n,i){var a="appid="+n+"&redirect_uri="+encodeURIComponent(t)+"&response_type=code&scope="+r+"&state="+e;i&&(a+="&component_appid="+i),location.href="https://open.weixin.qq.com/connect/oauth2/authorize?"+a+"#wechat_redirect"}function c(e,r){var n=t.parseUrl(e);if(n.search){var i=t.parseQuery(n.search.slice(1));if(i.state&&i.code){delete i.state,delete i.code;var a=t.stringifyQuery(i);n.search=a?"?"+a:""}}return r&&r(n),t.stringifyUrl(n)}var p={};function f(e,t){var r=n();return e>0&&r.getTimestamp()-e<t}var l=function(e){r=e},m=function(e,t,r,i){var s=n().getTimestamp(),o=encodeURIComponent(e+"@"+s);a(e,JSON.stringify({state:e,timestamp:s})),u(o,t,"snsapi_userinfo",r,i)},d=function(e,t,r,i){var s=n().getTimestamp(),o=encodeURIComponent(e+"@"+s);a(e,JSON.stringify({state:e,timestamp:s})),u(o,t,"snsapi_base",r,i)},h=function(e){var t;t=e,r.storage.remove("@@wechat@@_"+t)},g=function(e,r){var n=function(e){var r={},n=t.parseUrl(e);if(!n.search)return r;var i=t.parseQuery(n.search.slice(1));if(i.state&&i.code){var a=i.state.split("@"),s=a[0],o=a[1];r.code=i.code,r.state=s,r.timestamp=+o}return r}(e),a=n.state,s=n.code,o=n.timestamp;if(a&&s&&o){if(!r)return n;var u=r.once;if(!function(e,t){var r=t.expireSeconds,n=t.once,i=e.state,a=e.timestamp;return!(!i||!a||r&&!f(a,1e3*r)||n&&p[i])}(n,r))return{};if(!function(e,t){var r=i(e)||{};if(r&&"string"==typeof r)try{r=JSON.parse(r)}catch(e){r={}}var n=t.expireSeconds,a=t.once,s=r.state,o=r.timestamp;return!(!s||!o||n&&!f(o,1e3*n)||a&&p[s])}(a,r))return{};if(!function(e){var t=e.state,r=e.timestamp;if(t&&r){var n=i(t)||{};if(n&&"string"==typeof n)try{n=JSON.parse(n)}catch(e){n={}}return n.state===t&&n.timestamp===r}return!1}(n))return{};u&&(p[a]=!0)}return n},v=function(e,t,r,n,i){return void 0===i&&(i=!1),new Promise((function(a,s){e.config({debug:i,appId:t.appId,timestamp:t.timestamp,nonceStr:t.nonceStr,signature:t.signature,jsApiList:r}),e.ready((function(){e.checkJsApi({jsApiList:r,success:function(t){var r=t.checkResult;r.updateAppMessageShareData&&e.updateAppMessageShareData({title:n.title,desc:n.content,link:n.url,imgUrl:n.image}),r.updateTimelineShareData&&e.updateTimelineShareData({title:n.title,link:n.url,imgUrl:n.image}),r.onMenuShareWeibo&&e.onMenuShareWeibo({title:n.title,desc:n.content,link:n.url,imgUrl:n.image}),r.onMenuShareAppMessage&&e.onMenuShareAppMessage({title:n.title,desc:n.content,link:n.url,imgUrl:n.image}),r.onMenuShareTimeline&&e.onMenuShareTimeline({title:n.title,link:n.url,imgUrl:n.image})}})})),e.error((function(e){s(e)})),a()}))},y=function(e){return new Promise((function(t,r){window.WeixinJSBridge?window.WeixinJSBridge.invoke("getBrandWCPayRequest",e,(function(e){var n=e.err_msg;"get_brand_wcpay_request:ok"==n?t(e):"get_brand_wcpay_request:cancel"!==n&&r(n||"支付失败")})):r("缺少微信环境支持")}))},S=c,_=function(e,t){return c(e,(function(e){t&&t(e);var r=e.search&&"?"!==e.search;o&&!r&&e.hash&&(e.hash="?"+e.hash)}))};e.endAuth=h,e.getAuthQuery=g,e.init=l,e.normalizeShareUrl=_,e.normalizeUrl=S,e.pay=y,e.share=v,e.startAuth=m,e.startSilentAuth=d,e.version="1.3.3",Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=wechat.min.js.map
