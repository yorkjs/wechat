!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@yorkjs/url")):"function"==typeof define&&define.amd?define(["exports","@yorkjs/url"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Url={},e.Url)}(this,(function(e,t){"use strict";var n,r="auth_page_unload_timestamp";function i(){return n}function a(e){return n.storage.get("@@wechat@@_"+e)}function s(e,t){n.storage.set("@@wechat@@_"+e,t)}function o(e){n.storage.remove("@@wechat@@_"+e)}var u=navigator.userAgent;/iphone|ipad/i.test(u);var c=/android/i.test(u),p=!1;function f(e,t,n,r,i){var a="appid="+r+"&redirect_uri="+encodeURIComponent(t)+"&response_type=code&scope="+n+"&state="+e;i&&(a+="&component_appid="+i),p=!0,location.href="https://open.weixin.qq.com/connect/oauth2/authorize?"+a+"#wechat_redirect"}function l(e,n){var r=t.parseUrl(e);if(r.search){var i=t.parseQuery(r.search.slice(1));if(i.state&&i.code){delete i.state,delete i.code;var a=t.stringifyQuery(i);r.search=a?"?"+a:""}}return n&&n(r),t.stringifyUrl(r)}window.addEventListener("unload",(function(e){p&&s(r,i().getTimestamp())}));var d={};function m(e,t){var n=i().getTimestamp();if(e<=0)return!1;var s=n-e<t,o=!1,u=a(r);return u&&(o=n-u<t),s||o}var h=function(e){n=e},g=function(e,t,n,r){var a=i().getTimestamp(),o=encodeURIComponent(e+"@"+a);s(e,JSON.stringify({state:e,timestamp:a})),f(o,t,"snsapi_userinfo",n,r)},v=function(e,t,n,r){var a=i().getTimestamp(),o=encodeURIComponent(e+"@"+a);s(e,JSON.stringify({state:e,timestamp:a})),f(o,t,"snsapi_base",n,r)},y=function(e){o(r),o(e)},S=function(e,n){var r=function(e){var n={},r=t.parseUrl(e);if(!r.search)return n;var i=t.parseQuery(r.search.slice(1));if(i.state&&i.code){var a=i.state.split("@"),s=a[0],o=a[1];n.code=i.code,n.state=s,n.timestamp=+o}return n}(e),i=r.state,s=r.code,o=r.timestamp;if(i&&s&&o){if(!n)return r;var u=n.once;if(!function(e,t){var n=t.expireSeconds,r=t.once,i=e.state,a=e.timestamp;return!(!i||!a||n&&!m(a,1e3*n)||r&&d[i])}(r,n))return{};if(!function(e,t){var n=a(e)||{};if(n&&"string"==typeof n)try{n=JSON.parse(n)}catch(e){n={}}var r=t.expireSeconds,i=t.once,s=n.state,o=n.timestamp;return!(!s||!o||r&&!m(o,1e3*r)||i&&d[s])}(i,n))return{};if(!function(e){var t=e.state,n=e.timestamp;if(t&&n){var r=a(t)||{};if(r&&"string"==typeof r)try{r=JSON.parse(r)}catch(e){r={}}return r.state===t&&r.timestamp===n}return!1}(r))return{};u&&(d[i]=!0)}return r},_=function(e,t,n,r,i){return void 0===i&&(i=!1),new Promise((function(a,s){e.config({debug:i,appId:t.appId,timestamp:t.timestamp,nonceStr:t.nonceStr,signature:t.signature,jsApiList:n}),e.ready((function(){e.checkJsApi({jsApiList:n,success:function(t){var n=t.checkResult;n.updateAppMessageShareData&&e.updateAppMessageShareData({title:r.title,desc:r.content,link:r.url,imgUrl:r.image}),n.updateTimelineShareData&&e.updateTimelineShareData({title:r.title,link:r.url,imgUrl:r.image}),n.onMenuShareWeibo&&e.onMenuShareWeibo({title:r.title,desc:r.content,link:r.url,imgUrl:r.image}),n.onMenuShareAppMessage&&e.onMenuShareAppMessage({title:r.title,desc:r.content,link:r.url,imgUrl:r.image}),n.onMenuShareTimeline&&e.onMenuShareTimeline({title:r.title,link:r.url,imgUrl:r.image})}})})),e.error((function(e){s(e)})),a()}))},w=function(e){return new Promise((function(t,n){window.WeixinJSBridge?window.WeixinJSBridge.invoke("getBrandWCPayRequest",e,(function(e){var r=e.err_msg;"get_brand_wcpay_request:ok"==r?t(e):"get_brand_wcpay_request:cancel"!==r&&n(r||"支付失败")})):n("缺少微信环境支持")}))},U=l,A=function(e,t){return l(e,(function(e){t&&t(e);var n=e.search&&"?"!==e.search;c&&!n&&e.hash&&(e.hash="?"+e.hash)}))};e.endAuth=y,e.getAuthQuery=S,e.init=h,e.normalizeShareUrl=A,e.normalizeUrl=U,e.pay=w,e.share=_,e.startAuth=g,e.startSilentAuth=v,e.version="1.3.4",Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=wechat.min.js.map
